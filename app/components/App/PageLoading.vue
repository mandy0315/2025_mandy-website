<script setup lang="ts">
import { ref, onMounted, watch } from "vue";
const { progress, isLoading } = usePageLoading();

// SVG path
const paths = [
  "M139.41,118.74c10.99-12.92,21.91-25.89,32.97-38.74,19.77-22.95,38.73-46.68,61.94-66.42,3.03-2.58,6.23-5.05,9.65-7.05,2.36-1.38,5.22-2.49,7.89-2.54,2.14-.05,5.05,1.13,6.24,2.77,.94,1.3,.46,4.49-.52,6.2-6.77,11.81-14.05,23.34-20.77,35.18-13.34,23.52-26.06,47.38-33.9,73.44-1.47,4.89-2.38,10.01-2.96,15.1-1.1,9.54,2.97,12.84,12.4,10.55,1.39-.34,2.81-.55,4.32-.84-.63,4.55-4.13,7.39-10.12,8.51-14.85,2.79-23.53-5.51-21.68-20.59,2.76-22.46,12.31-42.54,22.02-62.52,5.42-11.15,11.48-21.99,16.77-33.57-3.08,2.73-6.28,5.34-9.23,8.2-21.33,20.7-39.57,44.06-57.97,67.3-7.85,9.91-15.9,19.66-23.89,29.46-.94,1.15-1.99,2.67-3.26,2.99-2.67,.69-6.08,1.74-8.11,.65-1.61-.87-2.68-4.96-2.17-7.19,3.32-14.36,7.03-28.63,10.82-42.88,5.27-19.8,10.73-39.55,15.45-59.89-7.52,8.56-15.38,16.85-22.49,25.73-17.37,21.68-34.1,43.86-51.66,65.38-10.21,12.53-21.73,23.96-36.17,31.8-7.58,4.12-15.62,6.66-24.38,4.2-5.23-1.47-9.61-4.18-10.56-10-.29-1.79,.9-3.82,1.41-5.74,1.63,.45,3.69,.43,4.83,1.43,6.57,5.82,13.79,5.9,21.39,2.8,9.95-4.05,18.14-10.82,24.87-18.84,15.39-18.34,29.93-37.38,45.15-55.87,15.96-19.39,32.24-38.52,48.54-57.62,2.33-2.73,5.24-5.49,8.47-6.79,2.88-1.15,7.28-1.45,9.69,.03,2.03,1.25,3.54,5.92,2.91,8.49-3.09,12.52-6.81,24.89-10.61,37.23-6.08,19.74-12.4,39.42-18.62,59.12l1.35,.53h-.01Z",
  "M559.5,109.17c-5.41,4.42-10.05,8.93-15.39,12.34-4.23,2.7-9.16,4.76-14.06,5.85-8.75,1.96-15.22-4.7-13.96-13.59,.11-.78,.01-1.6,.01-2.58-5.69,4.31-11.05,8.77-16.82,12.61-3.69,2.45-7.82,4.52-12.04,5.82-11.31,3.49-17.83-1.97-16.97-13.79,.13-1.74,.55-3.46,.85-5.27-5.83,5.16-11.35,10.42-17.27,15.19-5.5,4.43-11.71,7.5-19.11,7.41-9.09-.11-14.08-4.91-14.4-14.13-.03-.99,0-1.98,0-3.73-4.23,3.58-7.68,7.22-11.8,9.79-6.14,3.84-12.57,7.34-19.22,10.18-4.57,1.95-9.65,1.45-13.46-2.4-3.89-3.93-3.75-9.08-1.93-13.58,3.04-7.5,6.99-14.64,10.55-21.93,1.96-4.01,4.05-7.97,5.73-12.1,.54-1.32-.03-3.1-.1-4.66-1.72,.09-3.82-.41-5.08,.39-4.17,2.68-8.33,5.51-11.96,8.86-13.77,12.72-25.23,27.39-35.62,42.94-1,1.5-2.15,3.66-3.55,3.95-2.68,.56-5.92,.68-8.26-.42-1.14-.54-1.56-4.45-.98-6.45,1.11-3.88,3.16-7.49,5.17-12-6.3,5.24-11.54,10.32-17.5,14.34-5.28,3.56-11.09,6.88-17.14,8.65-10.11,2.95-15.3-1.72-14.92-12.12,.08-2.09,.48-4.17,.76-6.45-4.68,4.17-8.94,8.66-13.89,12.19-4.53,3.24-9.62,5.91-14.79,7.99-5.79,2.33-11.98,2.31-16.89-2.21-4.93-4.54-4.92-10.71-3.65-16.75,2.4-11.37,9.64-19.88,17.28-28.06,9.06-9.7,19.01-18.13,32.17-21.8,9.53-2.66,15.44-.87,21.25,6.63,1.52-1.4,2.88-3.03,4.58-4.12,2.95-1.88,5.98-1.77,8.66,.76,2.61,2.47,1.12,4.82-.23,7.17-6.04,10.49-12.19,20.93-18.05,31.52-1.75,3.16-3.04,6.67-3.93,10.17-1.32,5.2,1.42,7.8,6.11,5.28,6.97-3.74,13.75-8.07,19.93-12.99,13.49-10.74,23.68-24.04,29.79-40.4,1.01-2.71,3.87-5.59,6.54-6.54,2.17-.78,5.85,.57,7.84,2.22,1.12,.93,.92,4.73,0,6.61-3.2,6.62-6.97,12.98-10.46,19.33,7.7-7.3,14.9-15.16,23.19-21.62,5.17-4.03,11.73-7.12,18.13-8.54,8.24-1.83,13.23,4.29,10.57,12.34-2.43,7.35-6.03,14.31-9.2,21.41-2.3,5.14-4.98,10.14-6.98,15.39-.73,1.9-.81,5.11,.32,6.33,1.02,1.11,4.55,1.16,6.18,.25,5.33-2.98,10.98-5.91,15.25-10.13,9.68-9.57,18.62-19.88,27.82-29.92,9.12-9.95,19.37-18.22,32.59-22.08,8.13-2.38,14.26-1.03,21.13,4.76,1.37-2.47,2.74-4.86,4.03-7.28,9.18-17.3,18.3-34.64,27.55-51.9,2.1-3.92,4.19-8.15,9.66-8.29,4.97-.13,6.99,2.27,5.02,6.88-2.67,6.24-5.83,12.28-9,18.29-13.48,25.53-27.11,50.98-40.49,76.55-2.12,4.06-3.83,8.51-4.72,12.99-1.08,5.44,1.61,7.57,6.52,5.14,5.46-2.7,10.74-5.99,15.59-9.7,11.88-9.09,21.89-19.86,28.23-33.69,1.86-4.06,4.07-8,6.48-11.76,1.21-1.88,2.99-4.01,4.95-4.62,2.6-.81,5.62-.24,8.46-.26-.31,2.44,0,5.19-1.03,7.27-7.34,14.68-15.04,29.19-22.38,43.87-.87,1.73-.26,4.2-.34,6.33,2.2-.02,4.69,.62,6.56-.18,11.12-4.76,18.86-13.65,25.71-23.06,7.32-10.04,13.65-20.79,20.41-31.23,1.26-1.95,2.33-4.06,3.81-5.84,2.34-2.8,5.45-4.17,8.84-2.19,3.61,2.11,2.53,5.41,1.09,8.35-6.48,13.25-13.06,26.45-19.58,39.68-2.71,5.5-5.33,11.04-8.38,17.38,1.63-.88,2.68-1.38,3.66-1.98,15.94-9.77,31.18-20.42,43.66-34.58,1.19-1.35,3.06-2.09,4.76-3.22,2.25,3.99,.04,5.93-1.92,7.96-13.82,14.36-29.12,26.88-46.54,36.58-6.37,3.55-10.6,8.31-13.83,14.84-7.52,15.2-15.56,30.18-28.11,42.07-5.57,5.28-12.03,8.01-19.9,7.27-10.85-1.02-15.49-10.41-9.07-19.27,8.54-11.77,20.33-20.03,31.88-28.49,.8-.59,1.58-1.3,2.48-1.65,13.82-5.38,17.4-18.4,23.11-30.57h.04Zm-312.2,16.5c-.12,6.93,2.26,9,7.36,7.25,3.09-1.06,5.99-2.84,8.74-4.65,14.74-9.72,23.9-24.22,32.95-38.8,1.99-3.2,.73-5.38-2-7.08-4.66-2.9-9.07-1.03-13.13,1.31-14.87,8.6-25.31,21.23-32.42,36.7-.95,2.06-1.27,4.42-1.5,5.27h0Zm232.03-56.76c-4.39,2.09-8.5,3.49-12,5.8-11.2,7.39-18.96,17.99-25.78,29.27-2.12,3.5-3.81,7.4-4.85,11.34-.55,2.05,.03,5.28,1.41,6.68,1.09,1.1,4.34,.71,6.36,.1,2.47-.75,4.8-2.22,6.97-3.71,14.58-9.99,24.82-23.8,33.66-38.77,1.03-1.74,2-4.86,1.16-6.06-1.41-2.02-4.29-3-6.92-4.66h0Zm64.6,75.84c-.54-.53-1.08-1.07-1.62-1.6-5.91,4.73-12.11,9.15-17.64,14.28-4.59,4.25-8.69,9.13-12.39,14.19-1.08,1.47-.03,4.5,.04,6.82,2.32-.27,4.81-.1,6.89-.95,1.72-.7,3.21-2.42,4.35-4.01,6.86-9.52,13.59-19.14,20.37-28.73h0Z",
  "M209.27,207.87c3.32-7.1,6.46-12.58,8.45-18.44,2.2-6.47-1.51-11.97-8.38-12.26-20.28-.84-38.09,5.41-51.66,20.9-8.53,9.75-7.25,18.55,3,26.5,4.18,3.24,8.88,5.81,13.43,8.55,5.68,3.42,11.7,6.33,17.13,10.1,12.77,8.86,15.2,22.32,5.75,34.51-4.62,5.97-10.21,11.56-16.34,15.94-19.08,13.64-40.66,20.03-64.12,19.16-4.97-.19-10.07-2.06-14.73-4.05-6.67-2.85-10.36-8.5-10.34-15.74,.02-7.78,3.48-14.29,10.36-18.15,1.98-1.11,5.11-.17,7.72-.17-.4,2.09-.31,4.45-1.3,6.21-4.65,8.29-2.75,14.96,5.92,19.2,7.53,3.69,15.44,3.31,23.43,1.91,15.15-2.66,29.14-7.75,40.21-19.02,1.16-1.18,2.26-2.46,3.24-3.79,8.47-11.56,7.09-19.86-5.09-27.25-8.51-5.16-17.5-9.51-26.13-14.48-6.27-3.61-12.11-7.98-14.37-15.26-2.71-8.72,.52-16.42,5.57-23.32,10.27-14.03,25.07-21.4,41-26.83,9.63-3.28,19.51-5.21,29.83-4.17,11.96,1.2,17.86,8.8,15.44,20.55-1.59,7.71-6.17,13.53-12.47,17.97-1.31,.92-3.3,.88-5.53,1.43h-.02Z", "M447.31,232.62c1.35-3.24,2.74-6.57,4.11-9.91,1.49-3.64-.12-5.16-3.63-4.68-2.42,.33-4.94,.98-7.08,2.12-14.93,7.99-25.03,20.15-29.83,36.37-2.67,9.03,1.95,14.57,11.43,14.5,9.72-.07,18.02-4.36,25.75-9.58,10.51-7.09,19.89-15.26,27.04-26.13,9.22-14.03,21.22-25.25,38.12-29.61,3.45-.89,7.31-.96,10.87-.53,6.58,.8,11.13,8.14,8.65,14.74-1.7,4.52-4.52,8.94-7.82,12.49-9.24,9.95-20.99,15.59-34.39,17.47-4.22,.59-7.88,.51-7.44,6.49,.44,5.96,3.18,10.15,8.37,10.56,2.77,.22,5.68,.02,8.39-.6,13.99-3.17,24.6-12.01,34.92-21.27,3.72-3.34,7.22-6.92,10.98-10.2,1.24-1.08,3-1.57,4.52-2.33,.37,.29,.74,.58,1.11,.87-.5,1.55-.55,3.5-1.55,4.59-15.88,17.31-32.7,33.24-56.94,38.15-16.61,3.36-24.78-2.96-25.81-20.5-4.89,3.88-9.44,7.95-14.44,11.36-10.78,7.34-22.12,13.52-35.59,14.21-15.96,.82-23.27-6.53-22.2-21.78-6.36,5.56-12.75,11.62-19.67,17.02-3.59,2.8-7.89,5.05-12.22,6.45-10.64,3.45-16.46-1.45-15.65-12.59,.07-.96,.24-1.92,.39-3.13-4.68,3.97-8.8,8.46-13.82,11.46-5.57,3.33-11.74,6.24-18.03,7.64-8.39,1.87-14.61-3.9-14.77-12.54-.07-3.6,.62-7.22,.96-10.78-6.47,4.25-12.81,9.23-19.84,12.85-9.55,4.92-19.43,9.33-29.53,12.97-9.42,3.39-18.7,1.9-26.95-4.81-8.76,17.87-17.32,35.45-26.03,52.96-1.15,2.31-2.61,5.15-4.68,6.14-2.31,1.11-5.86,1.18-8.14,.12-1.12-.52-1.51-4.97-.67-6.99,3.46-8.25,7.38-16.33,11.4-24.33,14.52-28.92,29.14-57.8,43.8-86.65,.95-1.86,2.31-4.26,4-4.81,2.36-.77,5.7-.85,7.68,.34,1.44,.86,2.19,4.41,1.79,6.48-.62,3.26-2.46,6.3-3.53,8.84,6.66-4.47,13.26-9.49,20.45-13.45,3.42-1.88,8.05-2.67,11.99-2.32,10.16,.91,15.39,9.19,13.03,19.41-2.76,11.95-9.75,21.32-18.26,29.73-.91,.9-2.11,1.52-2.68,2.82,14.82-8.06,28.4-17.66,39.53-30.36,7.86-8.97,16.44-17.08,27.22-22.33,4.39-2.13,9.33-3.39,14.16-4.27,5.78-1.04,9.99,1.24,13.44,5.96,1.64-1.38,3.15-3.53,5.08-4.04,2.63-.69,6.01-.99,8.31,.11,3.15,1.51,2.17,4.86,.7,7.45-4.83,8.52-9.9,16.9-14.61,25.49-3.1,5.66-5.94,11.48-8.44,17.42-.77,1.84-.04,4.31,0,6.49,2.33-.21,5.15,.36,6.91-.75,12.97-8.18,23.55-19.06,32.67-31.24,8.5-11.35,17.82-21.77,30.91-27.61,5.88-2.62,12.64-4.06,19.09-4.41,8.95-.49,13.66,6.86,10.27,15.17-1.2,2.95-3.44,5.7-5.79,7.92-2.33,2.2-5.34,2.67-8.03-.65l.02,.02Zm-205.94,48.88c.13,.27,.27,.55,.4,.82,4.05-1.69,8.49-2.8,12.08-5.19,12.15-8.08,21.3-18.95,27.23-32.3,1.88-4.24,4.8-9.63,.58-13.41-4.42-3.96-9.57-.64-13.68,2.07-14.77,9.74-26.9,22.07-35.37,37.74-2.77,5.13-1.72,7.66,3.86,9.48,1.55,.51,3.26,.53,4.9,.78h0Zm74.91-13.12c0,6.57,2.95,8.72,8.09,6.75,2.59-1,5.09-2.41,7.39-3.99,14.4-9.82,24.09-23.57,32.03-38.73,2.48-4.74,1.23-8.14-4.02-8.42-4.14-.23-9.11,.86-12.5,3.16-13.67,9.24-23.01,22.28-29.93,37.11-.75,1.6-.9,3.49-1.06,4.14v-.02Zm170.48-24.31c8.83-1.53,16.02-4.59,22.5-9.35,5.45-4,10.08-8.73,12.18-15.32,.54-1.68,.68-4.39-.29-5.4-.99-1.05-3.66-1.08-5.4-.7-2.04,.44-4.03,1.58-5.77,2.81-9.93,7.02-17.69,15.89-23.21,27.95h-.01Z"
];

const pathRefs = ref<SVGPathElement[]>([]);
const pathLengths = ref<number[]>([]);

const updateDrawing = (pct: number) => {
  pathRefs.value.forEach((path, i) => {
    if (!path) return;
    const len = pathLengths.value[i] || 0;
    // 根據進度計算 offset
    // progress 0% → offset = len (完全隱藏)
    // progress 100% → offset = 0 (完全顯示)
    const offset = len * (1 - pct / 100);

    path.style.strokeDashoffset = `${offset}`;
  });
}
const updateFilling = () => {
  pathRefs.value.forEach((path) => {
    if (!path) return;
    path.style.transition = 'fill-opacity 0.8s ease-out';
    path.style.fillOpacity = '1';
  });
}

// 監聽 progress 變化，更新繪製 logo
watch(progress, (val) => {
  updateDrawing(val);
  if (val === 99) {
    updateFilling();
  }
});

const setPathLengths = () => {
  pathRefs.value.forEach((path, i) => {
    if (!path) return;
    const len = path.getTotalLength();
    pathLengths.value[i] = len;
  });
};
onMounted(() => {
  setPathLengths();
});


</script>

<template>
  <Transition name="fade">
    <div v-if="isLoading" class="fixed inset-0 z-110 bg-primary flex flex-col justify-center items-center gap-6">
      <!-- SVG Logo -->
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 622.31 344" class="w-64 h-auto">
        <path v-for="(d, i) in paths" :ref="(el) => (pathRefs[i] = el as SVGPathElement)" :key="i" :d="d"
          fill="currentColor" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
          class="text-[#fbf4ef] dark:text-[#1c1a3a]" />
      </svg>

      <!-- 百分比 -->
      <em class="text-[#fbf4ef] dark:text-[#1c1a3a] font-zen-old-mincho font-bold text-lg">
        Loading {{ Math.floor(progress) }}%
      </em>
    </div>
  </Transition>
</template>

<style scoped>
.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.4s ease 0.3s;
}

.fade-enter-from,
.fade-leave-to {
  opacity: 0;
}

/* 預設隱藏 */
path {
  /* 預設大數值 */
  stroke-dasharray: 2500;
  /* 預設隱藏 */
  stroke-dashoffset: 2500;
  /* 隱藏填充 */
  fill-opacity: 0;
}
</style>